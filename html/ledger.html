<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>ledger</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Keyword">open</a> <a id="6" class="Keyword">import</a> <a id="13" href="basicBitcoinDataType.html" class="Module">basicBitcoinDataType</a>

<a id="35" class="Keyword">module</a> <a id="42" href="ledger.html" class="Module">ledger</a> <a id="49" class="Symbol">(</a><a id="50" href="ledger.html#50" class="Bound">param</a> <a id="56" class="Symbol">:</a> <a id="58" href="basicBitcoinDataType.html#1053" class="Record">GlobalParameters</a><a id="74" class="Symbol">)</a> <a id="76" class="Keyword">where</a>

<a id="83" class="Keyword">open</a> <a id="88" class="Keyword">import</a> <a id="95" href="Data.Nat.html" class="Module">Data.Nat</a>  <a id="105" class="Keyword">hiding</a> <a id="112" class="Symbol">(</a><a id="113" href="Data.Nat.Base.html#1535" class="Datatype Operator">_≤_</a><a id="116" class="Symbol">)</a>
<a id="118" class="Keyword">open</a> <a id="123" class="Keyword">import</a> <a id="130" href="Data.List.html" class="Module">Data.List</a> <a id="140" class="Keyword">hiding</a> <a id="147" class="Symbol">(</a><a id="148" href="Data.List.Base.html#1810" class="Function Operator">_++_</a><a id="152" class="Symbol">)</a>
<a id="154" class="Keyword">open</a> <a id="159" class="Keyword">import</a> <a id="166" href="Data.Unit.html" class="Module">Data.Unit</a>  <a id="177" class="Keyword">hiding</a> <a id="184" class="Symbol">(</a><a id="185" href="Data.Unit.Base.html#1023" class="Record Operator">_≤_</a><a id="188" class="Symbol">)</a>
<a id="190" class="Keyword">open</a> <a id="195" class="Keyword">import</a> <a id="202" href="Data.Empty.html" class="Module">Data.Empty</a>
<a id="213" class="Keyword">open</a> <a id="218" class="Keyword">import</a> <a id="225" href="Data.Bool.html" class="Module">Data.Bool</a>  <a id="236" class="Keyword">hiding</a> <a id="243" class="Symbol">(</a><a id="244" href="Data.Bool.Base.html#672" class="Datatype Operator">_≤_</a> <a id="248" class="Symbol">;</a> <a id="250" href="Data.Bool.Base.html#1283" class="Function Operator">if_then_else_</a> <a id="264" class="Symbol">)</a> <a id="266" class="Keyword">renaming</a> <a id="275" class="Symbol">(</a><a id="276" href="Data.Bool.Base.html#986" class="Function Operator">_∧_</a> <a id="280" class="Symbol">to</a> <a id="283" class="Function Operator">_∧b_</a> <a id="288" class="Symbol">;</a> <a id="290" href="Data.Bool.Base.html#1044" class="Function Operator">_∨_</a> <a id="294" class="Symbol">to</a> <a id="297" class="Function Operator">_∨b_</a> <a id="302" class="Symbol">;</a> <a id="304" href="Data.Bool.Base.html#1451" class="Function">T</a> <a id="306" class="Symbol">to</a> <a id="309" class="Function">True</a><a id="313" class="Symbol">)</a>
<a id="315" class="Keyword">open</a> <a id="320" class="Keyword">import</a> <a id="327" href="Data.Bool.Base.html" class="Module">Data.Bool.Base</a> <a id="342" class="Keyword">hiding</a> <a id="349" class="Symbol">(</a><a id="350" href="Data.Bool.Base.html#672" class="Datatype Operator">_≤_</a> <a id="354" class="Symbol">;</a> <a id="356" href="Data.Bool.Base.html#1283" class="Function Operator">if_then_else_</a> <a id="370" class="Symbol">)</a> <a id="372" class="Keyword">renaming</a> <a id="381" class="Symbol">(</a><a id="382" href="Data.Bool.Base.html#986" class="Function Operator">_∧_</a> <a id="386" class="Symbol">to</a> <a id="389" class="Function Operator">_∧b_</a> <a id="394" class="Symbol">;</a> <a id="396" href="Data.Bool.Base.html#1044" class="Function Operator">_∨_</a> <a id="400" class="Symbol">to</a> <a id="403" class="Function Operator">_∨b_</a> <a id="408" class="Symbol">;</a> <a id="410" href="Data.Bool.Base.html#1451" class="Function">T</a> <a id="412" class="Symbol">to</a> <a id="415" class="Function">True</a><a id="419" class="Symbol">)</a>
<a id="421" class="Keyword">open</a> <a id="426" class="Keyword">import</a> <a id="433" href="Data.Product.html" class="Module">Data.Product</a> <a id="446" class="Keyword">renaming</a> <a id="455" class="Symbol">(</a><a id="456" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">_,_</a> <a id="460" class="Symbol">to</a> <a id="463" class="InductiveConstructor Operator">_,,_</a> <a id="468" class="Symbol">)</a>
<a id="470" class="Keyword">open</a> <a id="475" class="Keyword">import</a> <a id="482" href="Data.Nat.Base.html" class="Module">Data.Nat.Base</a> <a id="496" class="Keyword">hiding</a> <a id="503" class="Symbol">(</a><a id="504" href="Data.Nat.Base.html#1535" class="Datatype Operator">_≤_</a><a id="507" class="Symbol">)</a>
<a id="509" class="Keyword">open</a> <a id="514" class="Keyword">import</a> <a id="521" href="Data.List.NonEmpty.html" class="Module">Data.List.NonEmpty</a> <a id="540" class="Keyword">hiding</a> <a id="547" class="Symbol">(</a><a id="548" href="Data.List.NonEmpty.Base.html#1141" class="Field">head</a><a id="552" class="Symbol">)</a>
<a id="554" class="Keyword">open</a> <a id="559" class="Keyword">import</a> <a id="566" href="Data.Maybe.html" class="Module">Data.Maybe</a>

<a id="578" class="Keyword">open</a> <a id="583" class="Keyword">import</a> <a id="590" href="libraries.listLib.html" class="Module">libraries.listLib</a>
<a id="608" class="Keyword">open</a> <a id="613" class="Keyword">import</a> <a id="620" href="libraries.natLib.html" class="Module">libraries.natLib</a>
<a id="637" class="Keyword">open</a> <a id="642" class="Keyword">import</a> <a id="649" href="libraries.boolLib.html" class="Module">libraries.boolLib</a>

<a id="668" class="Keyword">open</a> <a id="673" class="Keyword">import</a> <a id="680" href="stack.html" class="Module">stack</a>
<a id="686" class="Keyword">open</a> <a id="691" class="Keyword">import</a> <a id="698" href="instruction.html" class="Module">instruction</a>

<a id="711" class="Keyword">record</a> <a id="SignedWithSigPbk"></a><a id="718" href="ledger.html#718" class="Record">SignedWithSigPbk</a> <a id="735" class="Symbol">(</a><a id="736" href="ledger.html#736" class="Bound">msg</a> <a id="740" class="Symbol">:</a> <a id="742" href="basicBitcoinDataType.html#738" class="Datatype">Msg</a><a id="745" class="Symbol">)(</a><a id="747" href="ledger.html#747" class="Bound">address</a> <a id="755" class="Symbol">:</a> <a id="757" href="basicBitcoinDataType.html#598" class="Function">Address</a><a id="764" class="Symbol">)</a> <a id="766" class="Symbol">:</a> <a id="768" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="772" class="Keyword">where</a>
  <a id="780" class="Keyword">field</a>  <a id="SignedWithSigPbk.publicKey"></a><a id="787" href="ledger.html#787" class="Field">publicKey</a>  <a id="798" class="Symbol">:</a>  <a id="801" href="basicBitcoinDataType.html#683" class="Function">PublicKey</a>
         <a id="SignedWithSigPbk.pbkCorrect"></a><a id="820" href="ledger.html#820" class="Field">pbkCorrect</a> <a id="831" class="Symbol">:</a>  <a id="834" href="ledger.html#50" class="Bound">param</a> <a id="840" class="Symbol">.</a><a id="841" href="basicBitcoinDataType.html#1094" class="Field">publicKey2Address</a> <a id="859" href="ledger.html#787" class="Field">publicKey</a> <a id="869" href="libraries.natLib.html#547" class="Function Operator">≡ℕ</a>  <a id="873" href="ledger.html#747" class="Bound">address</a>
         <a id="SignedWithSigPbk.signature"></a><a id="890" href="ledger.html#890" class="Field">signature</a>  <a id="901" class="Symbol">:</a>  <a id="904" href="basicBitcoinDataType.html#651" class="Function">Signature</a>
         <a id="SignedWithSigPbk.signed"></a><a id="923" href="ledger.html#923" class="Field">signed</a>     <a id="934" class="Symbol">:</a>  <a id="937" href="basicBitcoinDataType.html#1256" class="Function">Signed</a> <a id="944" href="ledger.html#50" class="Bound">param</a> <a id="950" href="ledger.html#736" class="Bound">msg</a> <a id="954" href="ledger.html#890" class="Field">signature</a> <a id="964" href="ledger.html#787" class="Field">publicKey</a>


<a id="976" class="Comment">-- record for the transaction field</a>
<a id="1012" class="Keyword">record</a> <a id="TXFieldNew"></a><a id="1019" href="ledger.html#1019" class="Record">TXFieldNew</a> <a id="1030" class="Symbol">:</a> <a id="1032" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="1036" class="Keyword">where</a>
  <a id="1044" class="Keyword">constructor</a> <a id="txFieldNew"></a><a id="1056" href="ledger.html#1056" class="InductiveConstructor">txFieldNew</a>
  <a id="1069" class="Keyword">field</a>  <a id="TXFieldNew.amount"></a><a id="1076" href="ledger.html#1076" class="Field">amount</a>         <a id="1091" class="Symbol">:</a>  <a id="1094" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>
         <a id="TXFieldNew.address"></a><a id="1105" href="ledger.html#1105" class="Field">address</a>        <a id="1120" class="Symbol">:</a>  <a id="1123" href="basicBitcoinDataType.html#598" class="Function">Address</a>
         <a id="TXFieldNew.smartContract"></a><a id="1140" href="ledger.html#1140" class="Field">smartContract</a>  <a id="1155" class="Symbol">:</a> <a id="1157" href="instruction.html#1861" class="Function">BitcoinScript</a>

<a id="1172" class="Keyword">open</a> <a id="1177" href="ledger.html#1019" class="Module">TXFieldNew</a> <a id="1188" class="Keyword">public</a>




<a id="txField2MsgNew"></a><a id="1199" href="ledger.html#1199" class="Function">txField2MsgNew</a> <a id="1214" class="Symbol">:</a> <a id="1216" class="Symbol">(</a><a id="1217" href="ledger.html#1217" class="Bound">inp</a> <a id="1221" class="Symbol">:</a> <a id="1223" href="ledger.html#1019" class="Record">TXFieldNew</a><a id="1233" class="Symbol">)</a> <a id="1235" class="Symbol">→</a> <a id="1237" href="basicBitcoinDataType.html#738" class="Datatype">Msg</a>
<a id="1241" href="ledger.html#1199" class="Function">txField2MsgNew</a> <a id="1256" href="ledger.html#1256" class="Bound">inp</a>  <a id="1261" class="Symbol">=</a>   <a id="1265" href="basicBitcoinDataType.html#757" class="InductiveConstructor">nat</a> <a id="1269" class="Symbol">(</a><a id="1270" href="ledger.html#1076" class="Field">amount</a> <a id="1277" href="ledger.html#1256" class="Bound">inp</a><a id="1280" class="Symbol">)</a> <a id="1282" href="basicBitcoinDataType.html#791" class="InductiveConstructor Operator">+msg</a> <a id="1287" href="basicBitcoinDataType.html#757" class="InductiveConstructor">nat</a> <a id="1291" class="Symbol">(</a><a id="1292" href="ledger.html#1105" class="Field">address</a> <a id="1300" href="ledger.html#1256" class="Bound">inp</a><a id="1303" class="Symbol">)</a>



<a id="txFieldList2MsgNew"></a><a id="1308" href="ledger.html#1308" class="Function">txFieldList2MsgNew</a> <a id="1327" class="Symbol">:</a> <a id="1329" class="Symbol">(</a><a id="1330" href="ledger.html#1330" class="Bound">inp</a> <a id="1334" class="Symbol">:</a> <a id="1336" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="1341" href="ledger.html#1019" class="Record">TXFieldNew</a><a id="1351" class="Symbol">)</a> <a id="1353" class="Symbol">→</a> <a id="1355" href="basicBitcoinDataType.html#738" class="Datatype">Msg</a>
<a id="1359" href="ledger.html#1308" class="Function">txFieldList2MsgNew</a> <a id="1378" href="ledger.html#1378" class="Bound">inp</a>  <a id="1383" class="Symbol">=</a> <a id="1385" href="basicBitcoinDataType.html#828" class="InductiveConstructor">list</a> <a id="1390" class="Symbol">(</a><a id="1391" href="libraries.listLib.html#857" class="Function">mapL</a> <a id="1396" href="ledger.html#1199" class="Function">txField2MsgNew</a> <a id="1411" href="ledger.html#1378" class="Bound">inp</a><a id="1414" class="Symbol">)</a>


<a id="txFieldList2TotalAmountNew"></a><a id="1418" href="ledger.html#1418" class="Function">txFieldList2TotalAmountNew</a> <a id="1445" class="Symbol">:</a> <a id="1447" class="Symbol">(</a><a id="1448" href="ledger.html#1448" class="Bound">inp</a> <a id="1452" class="Symbol">:</a> <a id="1454" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="1459" href="ledger.html#1019" class="Record">TXFieldNew</a><a id="1469" class="Symbol">)</a> <a id="1471" class="Symbol">→</a> <a id="1473" href="basicBitcoinDataType.html#572" class="Function">Amount</a>
<a id="1480" href="ledger.html#1418" class="Function">txFieldList2TotalAmountNew</a> <a id="1507" href="ledger.html#1507" class="Bound">inp</a> <a id="1511" class="Symbol">=</a> <a id="1513" href="libraries.listLib.html#7885" class="Function">sumListViaf</a> <a id="1525" href="ledger.html#1076" class="Field">amount</a> <a id="1532" href="ledger.html#1507" class="Bound">inp</a>



<a id="1539" class="Comment">-- record for unsigned transaction</a>
<a id="1574" class="Keyword">record</a> <a id="TXUnsignedNew"></a><a id="1581" href="ledger.html#1581" class="Record">TXUnsignedNew</a> <a id="1595" class="Symbol">:</a> <a id="1597" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="1601" class="Keyword">where</a>
  <a id="1609" class="Keyword">field</a>  <a id="TXUnsignedNew.inputs"></a><a id="1616" href="ledger.html#1616" class="Field">inputs</a>   <a id="1625" class="Symbol">:</a> <a id="1627" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="1632" href="ledger.html#1019" class="Record">TXFieldNew</a>
         <a id="TXUnsignedNew.outputs"></a><a id="1652" href="ledger.html#1652" class="Field">outputs</a>  <a id="1661" class="Symbol">:</a> <a id="1663" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="1668" href="ledger.html#1019" class="Record">TXFieldNew</a>
         <a id="TXUnsignedNew.TXID1"></a><a id="1688" href="ledger.html#1688" class="Field">TXID1</a>     <a id="1698" class="Symbol">:</a> <a id="1700" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>
<a id="1702" class="Keyword">open</a> <a id="1707" href="ledger.html#1581" class="Module">TXUnsignedNew</a> <a id="1721" class="Keyword">public</a>




<a id="txUnsigned2MsgNew"></a><a id="1732" href="ledger.html#1732" class="Function">txUnsigned2MsgNew</a> <a id="1750" class="Symbol">:</a>  <a id="1753" class="Symbol">(</a><a id="1754" href="ledger.html#1754" class="Bound">transac</a> <a id="1762" class="Symbol">:</a> <a id="1764" href="ledger.html#1581" class="Record">TXUnsignedNew</a><a id="1777" class="Symbol">)</a> <a id="1779" class="Symbol">→</a> <a id="1781" href="basicBitcoinDataType.html#738" class="Datatype">Msg</a>
<a id="1785" href="ledger.html#1732" class="Function">txUnsigned2MsgNew</a> <a id="1803" href="ledger.html#1803" class="Bound">transac</a> <a id="1811" class="Symbol">=</a> <a id="1813" href="ledger.html#1308" class="Function">txFieldList2MsgNew</a> <a id="1832" class="Symbol">(</a><a id="1833" href="ledger.html#1616" class="Field">inputs</a> <a id="1840" href="ledger.html#1803" class="Bound">transac</a><a id="1847" class="Symbol">)</a>  <a id="1850" href="basicBitcoinDataType.html#791" class="InductiveConstructor Operator">+msg</a> <a id="1855" href="ledger.html#1308" class="Function">txFieldList2MsgNew</a> <a id="1874" class="Symbol">(</a><a id="1875" href="ledger.html#1652" class="Field">outputs</a> <a id="1883" href="ledger.html#1803" class="Bound">transac</a><a id="1890" class="Symbol">)</a>




<a id="txInput2MsgNew"></a><a id="1896" href="ledger.html#1896" class="Function">txInput2MsgNew</a> <a id="1911" class="Symbol">:</a> <a id="1913" class="Symbol">(</a><a id="1914" href="ledger.html#1914" class="Bound">inp</a> <a id="1918" class="Symbol">:</a> <a id="1920" href="ledger.html#1019" class="Record">TXFieldNew</a><a id="1930" class="Symbol">)(</a><a id="1932" href="ledger.html#1932" class="Bound">outp</a> <a id="1937" class="Symbol">:</a> <a id="1939" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="1944" href="ledger.html#1019" class="Record">TXFieldNew</a><a id="1954" class="Symbol">)</a> <a id="1956" class="Symbol">→</a> <a id="1958" href="basicBitcoinDataType.html#738" class="Datatype">Msg</a>
<a id="1962" href="ledger.html#1896" class="Function">txInput2MsgNew</a> <a id="1977" href="ledger.html#1977" class="Bound">inp</a> <a id="1981" href="ledger.html#1981" class="Bound">outp</a> <a id="1986" class="Symbol">=</a> <a id="1988" href="ledger.html#1199" class="Function">txField2MsgNew</a> <a id="2003" href="ledger.html#1977" class="Bound">inp</a> <a id="2007" href="basicBitcoinDataType.html#791" class="InductiveConstructor Operator">+msg</a> <a id="2012" href="ledger.html#1308" class="Function">txFieldList2MsgNew</a> <a id="2031" href="ledger.html#1981" class="Bound">outp</a>

<a id="tx2SignauxNew"></a><a id="2037" href="ledger.html#2037" class="Function">tx2SignauxNew</a> <a id="2051" class="Symbol">:</a> <a id="2053" class="Symbol">(</a><a id="2054" href="ledger.html#2054" class="Bound">inp</a> <a id="2058" class="Symbol">:</a> <a id="2060" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="2065" href="ledger.html#1019" class="Record">TXFieldNew</a><a id="2075" class="Symbol">)</a> <a id="2077" class="Symbol">(</a><a id="2078" href="ledger.html#2078" class="Bound">outp</a> <a id="2083" class="Symbol">:</a> <a id="2085" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="2090" href="ledger.html#1019" class="Record">TXFieldNew</a><a id="2100" class="Symbol">)</a>  <a id="2103" class="Symbol">→</a> <a id="2105" href="Agda.Primitive.html#326" class="Primitive">Set</a>
<a id="2109" href="ledger.html#2037" class="Function">tx2SignauxNew</a> <a id="2123" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>               <a id="2140" href="ledger.html#2140" class="Bound">outp</a>  <a id="2146" class="Symbol">=</a> <a id="2148" href="Agda.Builtin.Unit.html#164" class="Record">⊤</a>
<a id="2150" href="ledger.html#2037" class="Function">tx2SignauxNew</a> <a id="2164" class="Symbol">(</a><a id="2165" href="ledger.html#2165" class="Bound">inp</a> <a id="2169" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="2171" href="ledger.html#2171" class="Bound">restinp</a><a id="2178" class="Symbol">)</a>  <a id="2181" href="ledger.html#2181" class="Bound">outp</a>  <a id="2187" class="Symbol">=</a>
    <a id="2193" href="ledger.html#718" class="Record">SignedWithSigPbk</a> <a id="2210" class="Symbol">(</a><a id="2211" href="ledger.html#1896" class="Function">txInput2MsgNew</a> <a id="2226" href="ledger.html#2165" class="Bound">inp</a> <a id="2230" href="ledger.html#2181" class="Bound">outp</a><a id="2234" class="Symbol">)</a> <a id="2236" class="Symbol">(</a><a id="2237" href="ledger.html#1105" class="Field">address</a> <a id="2245" href="ledger.html#2165" class="Bound">inp</a><a id="2248" class="Symbol">)</a> <a id="2250" href="Data.Product.html#1167" class="Function Operator">×</a>  <a id="2253" href="ledger.html#2037" class="Function">tx2SignauxNew</a> <a id="2267" href="ledger.html#2171" class="Bound">restinp</a> <a id="2275" href="ledger.html#2181" class="Bound">outp</a>




<a id="tx2SignNew"></a><a id="2284" href="ledger.html#2284" class="Function">tx2SignNew</a> <a id="2295" class="Symbol">:</a> <a id="2297" href="ledger.html#1581" class="Record">TXUnsignedNew</a> <a id="2311" class="Symbol">→</a> <a id="2313" href="Agda.Primitive.html#326" class="Primitive">Set</a>
<a id="2317" href="ledger.html#2284" class="Function">tx2SignNew</a> <a id="2328" href="ledger.html#2328" class="Bound">tr</a> <a id="2331" class="Symbol">=</a> <a id="2333" href="ledger.html#2037" class="Function">tx2SignauxNew</a> <a id="2347" class="Symbol">(</a><a id="2348" href="ledger.html#1616" class="Field">inputs</a> <a id="2355" href="ledger.html#2328" class="Bound">tr</a><a id="2357" class="Symbol">)</a> <a id="2359" class="Symbol">(</a><a id="2360" href="ledger.html#1652" class="Field">outputs</a> <a id="2368" href="ledger.html#2328" class="Bound">tr</a><a id="2370" class="Symbol">)</a>

<a id="2373" class="Comment">-- \bitcoinVersFive</a>


<a id="2395" class="Keyword">record</a> <a id="TXNew"></a><a id="2402" href="ledger.html#2402" class="Record">TXNew</a> <a id="2408" class="Symbol">:</a> <a id="2410" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="2414" class="Keyword">where</a>
  <a id="2422" class="Keyword">field</a>  <a id="TXNew.tx"></a><a id="2429" href="ledger.html#2429" class="Field">tx</a>       <a id="2438" class="Symbol">:</a> <a id="2440" href="ledger.html#1581" class="Record">TXUnsignedNew</a>
         <a id="TXNew.cor"></a><a id="2463" href="ledger.html#2463" class="Field">cor</a>      <a id="2472" class="Symbol">:</a> <a id="2474" href="ledger.html#1418" class="Function">txFieldList2TotalAmountNew</a> <a id="2501" class="Symbol">(</a><a id="2502" href="ledger.html#1616" class="Field">inputs</a> <a id="2509" href="ledger.html#2429" class="Field">tx</a><a id="2511" class="Symbol">)</a> <a id="2513" href="Data.Nat.Base.html#1679" class="Function Operator">≥</a> <a id="2515" href="ledger.html#1418" class="Function">txFieldList2TotalAmountNew</a> <a id="2542" class="Symbol">(</a><a id="2543" href="ledger.html#1652" class="Field">outputs</a> <a id="2551" href="ledger.html#2429" class="Field">tx</a><a id="2553" class="Symbol">)</a>
         <a id="TXNew.nonEmpt"></a><a id="2564" href="ledger.html#2564" class="Field">nonEmpt</a>  <a id="2573" class="Symbol">:</a> <a id="2575" href="libraries.listLib.html#8204" class="Function">NonNil</a> <a id="2582" class="Symbol">(</a><a id="2583" href="ledger.html#1616" class="Field">inputs</a> <a id="2590" href="ledger.html#2429" class="Field">tx</a><a id="2592" class="Symbol">)</a> <a id="2594" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="2596" href="libraries.listLib.html#8204" class="Function">NonNil</a> <a id="2603" class="Symbol">(</a><a id="2604" href="ledger.html#1652" class="Field">outputs</a> <a id="2612" href="ledger.html#2429" class="Field">tx</a><a id="2614" class="Symbol">)</a>
         <a id="TXNew.sig"></a><a id="2625" href="ledger.html#2625" class="Field">sig</a>      <a id="2634" class="Symbol">:</a> <a id="2636" href="ledger.html#2284" class="Function">tx2SignNew</a> <a id="2647" href="ledger.html#2429" class="Field">tx</a>

<a id="2651" class="Keyword">open</a> <a id="2656" href="ledger.html#2402" class="Module">TXNew</a> <a id="2662" class="Keyword">public</a>


<a id="2671" class="Comment">--record for a ledger</a>
<a id="2693" class="Keyword">record</a> <a id="ledgerEntryNew"></a><a id="2700" href="ledger.html#2700" class="Record">ledgerEntryNew</a> <a id="2715" class="Symbol">:</a> <a id="2717" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="2721" class="Keyword">where</a>   
  <a id="2732" class="Keyword">constructor</a> <a id="ledgerEntrNew"></a><a id="2744" href="ledger.html#2744" class="InductiveConstructor">ledgerEntrNew</a>
  <a id="2760" class="Keyword">field</a> <a id="ledgerEntryNew.ins"></a><a id="2766" href="ledger.html#2766" class="Field">ins</a>       <a id="2776" class="Symbol">:</a> <a id="2778" href="instruction.html#1861" class="Function">BitcoinScript</a>
        <a id="ledgerEntryNew.amount"></a><a id="2800" href="ledger.html#2800" class="Field">amount</a>    <a id="2810" class="Symbol">:</a> <a id="2812" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>

<a id="2815" class="Keyword">open</a> <a id="2820" href="ledger.html#2700" class="Module">ledgerEntryNew</a> <a id="2835" class="Keyword">public</a>

<a id="2843" class="Keyword">record</a> <a id="LedgerNew"></a><a id="2850" href="ledger.html#2850" class="Record">LedgerNew</a> <a id="2860" class="Symbol">:</a> <a id="2862" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="2866" class="Keyword">where</a>
  <a id="2874" class="Keyword">constructor</a> <a id="ledger"></a><a id="2886" href="ledger.html#2886" class="InductiveConstructor">ledger</a>
  <a id="2895" class="Keyword">field</a>
     <a id="LedgerNew.entries"></a><a id="2906" href="ledger.html#2906" class="Field">entries</a>        <a id="2921" class="Symbol">:</a> <a id="2923" class="Symbol">(</a><a id="2924" href="ledger.html#2924" class="Bound">addr</a> <a id="2929" class="Symbol">:</a> <a id="2931" href="basicBitcoinDataType.html#598" class="Function">Address</a><a id="2938" class="Symbol">)</a> <a id="2940" class="Symbol">→</a> <a id="2942" href="Agda.Builtin.Maybe.html#136" class="Datatype">Maybe</a> <a id="2948" href="ledger.html#2700" class="Record">ledgerEntryNew</a>
     <a id="LedgerNew.currentTime"></a><a id="2968" href="ledger.html#2968" class="Field">currentTime</a>    <a id="2983" class="Symbol">:</a> <a id="2985" href="basicBitcoinDataType.html#546" class="Function">Time</a>
<a id="2990" class="Keyword">open</a> <a id="2995" href="ledger.html#2850" class="Module">LedgerNew</a> <a id="3005" class="Keyword">public</a>


<a id="3014" class="Comment">--record for transaction entry</a>
<a id="3045" class="Keyword">record</a> <a id="TXEntryNew"></a><a id="3052" href="ledger.html#3052" class="Record">TXEntryNew</a> <a id="3063" class="Symbol">:</a> <a id="3065" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="3069" class="Keyword">where</a>
  <a id="3077" class="Keyword">constructor</a> <a id="txentryNew"></a><a id="3089" href="ledger.html#3089" class="InductiveConstructor">txentryNew</a>
  <a id="3102" class="Keyword">field</a> <a id="TXEntryNew.amount"></a><a id="3108" href="ledger.html#3108" class="Field">amount</a>              <a id="3128" class="Symbol">:</a> <a id="3130" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>
        <a id="TXEntryNew.smartContract"></a><a id="3140" href="ledger.html#3140" class="Field">smartContract</a>       <a id="3160" class="Symbol">:</a> <a id="3162" href="instruction.html#1861" class="Function">BitcoinScript</a>
        <a id="TXEntryNew.address"></a><a id="3184" href="ledger.html#3184" class="Field">address</a>             <a id="3204" class="Symbol">:</a> <a id="3206" href="basicBitcoinDataType.html#598" class="Function">Address</a> <a id="3214" class="Comment">-- indentifiers for unspentTX outputs (UTXO) (Lists of UTXO)</a>

<a id="3276" class="Keyword">open</a> <a id="3281" href="ledger.html#3052" class="Module">TXEntryNew</a> <a id="3292" class="Keyword">public</a>


<a id="testLedgerNewEntries"></a><a id="3301" href="ledger.html#3301" class="Function">testLedgerNewEntries</a> <a id="3322" class="Symbol">:</a> <a id="3324" href="basicBitcoinDataType.html#598" class="Function">Address</a> <a id="3332" class="Symbol">→</a> <a id="3334" href="Agda.Builtin.Maybe.html#136" class="Datatype">Maybe</a> <a id="3340" href="ledger.html#2700" class="Record">ledgerEntryNew</a>
<a id="3355" href="ledger.html#3301" class="Function">testLedgerNewEntries</a> <a id="3376" href="Agda.Builtin.Nat.html#210" class="InductiveConstructor">zero</a> <a id="3381" class="Symbol">=</a> <a id="3383" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="3388" class="Symbol">(</a><a id="3389" href="ledger.html#2744" class="InductiveConstructor">ledgerEntrNew</a> <a id="3403" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a> <a id="3406" class="Number">50</a><a id="3408" class="Symbol">)</a>
<a id="3410" href="ledger.html#3301" class="Function">testLedgerNewEntries</a> <a id="3431" class="Symbol">(</a><a id="3432" href="Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a> <a id="3436" href="Agda.Builtin.Nat.html#210" class="InductiveConstructor">zero</a><a id="3440" class="Symbol">)</a> <a id="3442" class="Symbol">=</a> <a id="3444" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="3449" class="Symbol">(</a><a id="3450" href="ledger.html#2744" class="InductiveConstructor">ledgerEntrNew</a> <a id="3464" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a> <a id="3467" class="Number">80</a><a id="3469" class="Symbol">)</a>
<a id="3471" href="ledger.html#3301" class="Function">testLedgerNewEntries</a> <a id="3492" class="Symbol">(</a><a id="3493" href="Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a> <a id="3497" class="Symbol">(</a><a id="3498" href="Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a> <a id="3502" href="ledger.html#3502" class="Bound">x</a><a id="3503" class="Symbol">))</a> <a id="3506" class="Symbol">=</a> <a id="3508" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a>

<a id="testLedgerNew"></a><a id="3517" href="ledger.html#3517" class="Function">testLedgerNew</a> <a id="3531" class="Symbol">:</a> <a id="3533" href="ledger.html#2850" class="Record">LedgerNew</a>
<a id="3543" href="ledger.html#3517" class="Function">testLedgerNew</a> <a id="3557" class="Symbol">.</a><a id="3558" href="ledger.html#2906" class="Field">entries</a> <a id="3566" class="Symbol">=</a> <a id="3568" href="ledger.html#3301" class="Function">testLedgerNewEntries</a>
<a id="3589" href="ledger.html#3517" class="Function">testLedgerNew</a> <a id="3603" class="Symbol">.</a><a id="3604" href="ledger.html#2968" class="Field">currentTime</a> <a id="3616" class="Symbol">=</a> <a id="3618" class="Number">31</a>

<a id="3622" class="Comment">-- record for transaction</a>
<a id="3648" class="Keyword">record</a> <a id="transactionNew"></a><a id="3655" href="ledger.html#3655" class="Record">transactionNew</a> <a id="3670" class="Symbol">:</a> <a id="3672" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="3676" class="Keyword">where</a> 
  <a id="3685" class="Keyword">constructor</a> <a id="transactNew"></a><a id="3697" href="ledger.html#3697" class="InductiveConstructor">transactNew</a>
  <a id="3711" class="Keyword">field</a> <a id="transactionNew.txid"></a><a id="3717" href="ledger.html#3717" class="Field">txid</a>      <a id="3727" class="Symbol">:</a> <a id="3729" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>
        <a id="transactionNew.inputs"></a><a id="3739" href="ledger.html#3739" class="Field">inputs</a>    <a id="3749" class="Symbol">:</a> <a id="3751" href="ledger.html#3052" class="Record">TXEntryNew</a>
        <a id="transactionNew.outputs"></a><a id="3770" href="ledger.html#3770" class="Field">outputs</a>   <a id="3780" class="Symbol">:</a> <a id="3782" href="ledger.html#3052" class="Record">TXEntryNew</a>

<a id="3794" class="Keyword">open</a> <a id="3799" href="ledger.html#3655" class="Module">transactionNew</a> <a id="3814" class="Keyword">public</a>

<a id="3822" class="Comment">-- function that is used to check if the coins go to the same address</a>
<a id="processLedger"></a><a id="3892" href="ledger.html#3892" class="Function">processLedger</a> <a id="3906" class="Symbol">:</a> <a id="3908" href="ledger.html#2850" class="Record">LedgerNew</a> <a id="3918" class="Symbol">→</a>  <a id="3921" href="ledger.html#3655" class="Record">transactionNew</a>  <a id="3937" class="Symbol">→</a> <a id="3939" href="ledger.html#2850" class="Record">LedgerNew</a>
<a id="3949" href="ledger.html#3892" class="Function">processLedger</a> <a id="3963" href="ledger.html#3963" class="Bound">oldLed</a>
              <a id="3984" class="Symbol">(</a><a id="3985" href="ledger.html#3697" class="InductiveConstructor">transactNew</a> <a id="3997" href="ledger.html#3997" class="Bound">txid₁</a> <a id="4003" class="Symbol">(</a><a id="4004" href="ledger.html#3089" class="InductiveConstructor">txentryNew</a> <a id="4015" href="ledger.html#4015" class="Bound">amount₁</a> <a id="4023" href="ledger.html#4023" class="Bound">smartContract₁</a> <a id="4038" href="ledger.html#4038" class="Bound">recipientAddress</a><a id="4054" class="Symbol">)</a>
                <a id="4072" class="Symbol">(</a><a id="4073" href="ledger.html#3089" class="InductiveConstructor">txentryNew</a> <a id="4084" href="ledger.html#4084" class="Bound">amount₂</a> <a id="4092" href="ledger.html#4092" class="Bound">smartContract₂</a> <a id="4107" href="ledger.html#4107" class="Bound">desinntationAddress</a><a id="4126" class="Symbol">))</a>
              <a id="4143" class="Symbol">.</a><a id="4144" href="ledger.html#2906" class="Field">entries</a> <a id="4152" href="ledger.html#4152" class="Bound">addr</a>
            <a id="4169" class="Symbol">=</a>  <a id="4172" href="libraries.boolLib.html#229" class="Function Operator">if</a> <a id="4175" class="Symbol">(</a><a id="4176" href="ledger.html#4152" class="Bound">addr</a> <a id="4181" href="libraries.natLib.html#736" class="Function Operator">==b</a> <a id="4185" href="ledger.html#4038" class="Bound">recipientAddress</a><a id="4201" class="Symbol">)</a>
               <a id="4218" href="libraries.boolLib.html#229" class="Function Operator">then</a> <a id="4223" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a>
               <a id="4246" href="libraries.boolLib.html#229" class="Function Operator">else</a> <a id="4251" class="Symbol">(</a> <a id="4253" href="libraries.boolLib.html#229" class="Function Operator">if</a> <a id="4256" class="Symbol">(</a><a id="4257" href="ledger.html#4152" class="Bound">addr</a> <a id="4262" href="libraries.natLib.html#736" class="Function Operator">==b</a> <a id="4266" href="ledger.html#4107" class="Bound">desinntationAddress</a><a id="4285" class="Symbol">)</a>
                      <a id="4309" href="libraries.boolLib.html#229" class="Function Operator">then</a>  <a id="4315" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="4320" class="Symbol">(</a><a id="4321" href="ledger.html#2744" class="InductiveConstructor">ledgerEntrNew</a> <a id="4335" href="ledger.html#4092" class="Bound">smartContract₂</a>  <a id="4351" href="ledger.html#4084" class="Bound">amount₂</a><a id="4358" class="Symbol">)</a>
                      <a id="4382" href="libraries.boolLib.html#229" class="Function Operator">else</a>  <a id="4388" href="ledger.html#3963" class="Bound">oldLed</a> <a id="4395" class="Symbol">.</a><a id="4396" href="ledger.html#2906" class="Field">entries</a> <a id="4404" href="ledger.html#4152" class="Bound">addr</a> <a id="4409" class="Symbol">)</a>
<a id="4411" href="ledger.html#3892" class="Function">processLedger</a> <a id="4425" href="ledger.html#4425" class="Bound">oldLed</a> <a id="4432" href="ledger.html#4432" class="Bound">trans</a> <a id="4438" class="Symbol">.</a><a id="4439" href="ledger.html#2968" class="Field">currentTime</a> <a id="4451" class="Symbol">=</a> <a id="4453" href="Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a> <a id="4457" class="Symbol">(</a><a id="4458" href="ledger.html#4425" class="Bound">oldLed</a> <a id="4465" class="Symbol">.</a><a id="4466" href="ledger.html#2968" class="Field">currentTime</a><a id="4477" class="Symbol">)</a>

<a id="tx2MsgNew"></a><a id="4480" href="ledger.html#4480" class="Function">tx2MsgNew</a> <a id="4490" class="Symbol">:</a> <a id="4492" href="ledger.html#3655" class="Record">transactionNew</a> <a id="4507" class="Symbol">→</a> <a id="4509" href="basicBitcoinDataType.html#738" class="Datatype">Msg</a>
<a id="4513" href="ledger.html#4480" class="Function">tx2MsgNew</a>  <a id="4524" href="ledger.html#4524" class="Bound">t</a>  <a id="4527" class="Symbol">=</a> <a id="4529" href="basicBitcoinDataType.html#757" class="InductiveConstructor">nat</a> <a id="4533" class="Symbol">(</a><a id="4534" href="ledger.html#3717" class="Field">txid</a> <a id="4539" href="ledger.html#4524" class="Bound">t</a><a id="4540" class="Symbol">)</a>
</pre></body></html>