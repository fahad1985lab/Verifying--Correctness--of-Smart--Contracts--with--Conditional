<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>ledger</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Keyword">open</a> <a id="6" class="Keyword">import</a> <a id="13" href="basicBitcoinDataType.html" class="Module">basicBitcoinDataType</a>

<a id="35" class="Keyword">module</a> <a id="42" href="ledger.html" class="Module">ledger</a> <a id="49" class="Symbol">(</a><a id="50" href="ledger.html#50" class="Bound">param</a> <a id="56" class="Symbol">:</a> <a id="58" href="basicBitcoinDataType.html#1041" class="Record">GlobalParameters</a><a id="74" class="Symbol">)</a> <a id="76" class="Keyword">where</a>

<a id="83" class="Keyword">open</a> <a id="88" class="Keyword">import</a> <a id="95" href="Data.Nat.html" class="Module">Data.Nat</a>  <a id="105" class="Keyword">hiding</a> <a id="112" class="Symbol">(</a><a id="113" href="Data.Nat.Base.html#1691" class="Datatype Operator">_≤_</a><a id="116" class="Symbol">)</a>
<a id="118" class="Keyword">open</a> <a id="123" class="Keyword">import</a> <a id="130" href="Data.List.html" class="Module">Data.List</a> <a id="140" class="Keyword">hiding</a> <a id="147" class="Symbol">(</a><a id="148" href="Data.List.Base.html#1954" class="Function Operator">_++_</a><a id="152" class="Symbol">)</a>
<a id="154" class="Keyword">open</a> <a id="159" class="Keyword">import</a> <a id="166" href="Data.Unit.html" class="Module">Data.Unit</a>  
<a id="178" class="Keyword">open</a> <a id="183" class="Keyword">import</a> <a id="190" href="Data.Empty.html" class="Module">Data.Empty</a>
<a id="201" class="Keyword">open</a> <a id="206" class="Keyword">import</a> <a id="213" href="Data.Bool.html" class="Module">Data.Bool</a>  <a id="224" class="Keyword">hiding</a> <a id="231" class="Symbol">(</a><a id="232" href="Data.Bool.Base.html#681" class="Datatype Operator">_≤_</a> <a id="236" class="Symbol">;</a> <a id="238" href="Data.Bool.Base.html#1505" class="Function Operator">if_then_else_</a> <a id="252" class="Symbol">)</a> <a id="254" class="Keyword">renaming</a> <a id="263" class="Symbol">(</a><a id="264" href="Data.Bool.Base.html#995" class="Function Operator">_∧_</a> <a id="268" class="Symbol">to</a> <a id="271" class="Function Operator">_∧b_</a> <a id="276" class="Symbol">;</a> <a id="278" href="Data.Bool.Base.html#1053" class="Function Operator">_∨_</a> <a id="282" class="Symbol">to</a> <a id="285" class="Function Operator">_∨b_</a> <a id="290" class="Symbol">;</a> <a id="292" href="Data.Bool.Base.html#1348" class="Function">T</a> <a id="294" class="Symbol">to</a> <a id="297" class="Function">True</a><a id="301" class="Symbol">)</a>
<a id="303" class="Keyword">open</a> <a id="308" class="Keyword">import</a> <a id="315" href="Data.Bool.Base.html" class="Module">Data.Bool.Base</a> <a id="330" class="Keyword">hiding</a> <a id="337" class="Symbol">(</a><a id="338" href="Data.Bool.Base.html#681" class="Datatype Operator">_≤_</a> <a id="342" class="Symbol">;</a> <a id="344" href="Data.Bool.Base.html#1505" class="Function Operator">if_then_else_</a> <a id="358" class="Symbol">)</a> <a id="360" class="Keyword">renaming</a> <a id="369" class="Symbol">(</a><a id="370" href="Data.Bool.Base.html#995" class="Function Operator">_∧_</a> <a id="374" class="Symbol">to</a> <a id="377" class="Function Operator">_∧b_</a> <a id="382" class="Symbol">;</a> <a id="384" href="Data.Bool.Base.html#1053" class="Function Operator">_∨_</a> <a id="388" class="Symbol">to</a> <a id="391" class="Function Operator">_∨b_</a> <a id="396" class="Symbol">;</a> <a id="398" href="Data.Bool.Base.html#1348" class="Function">T</a> <a id="400" class="Symbol">to</a> <a id="403" class="Function">True</a><a id="407" class="Symbol">)</a>
<a id="409" class="Keyword">open</a> <a id="414" class="Keyword">import</a> <a id="421" href="Data.Product.html" class="Module">Data.Product</a> <a id="434" class="Keyword">renaming</a> <a id="443" class="Symbol">(</a><a id="444" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">_,_</a> <a id="448" class="Symbol">to</a> <a id="451" class="InductiveConstructor Operator">_,,_</a> <a id="456" class="Symbol">)</a>
<a id="458" class="Keyword">open</a> <a id="463" class="Keyword">import</a> <a id="470" href="Data.Nat.Base.html" class="Module">Data.Nat.Base</a> <a id="484" class="Keyword">hiding</a> <a id="491" class="Symbol">(</a><a id="492" href="Data.Nat.Base.html#1691" class="Datatype Operator">_≤_</a><a id="495" class="Symbol">)</a>
<a id="497" class="Keyword">open</a> <a id="502" class="Keyword">import</a> <a id="509" href="Data.List.NonEmpty.html" class="Module">Data.List.NonEmpty</a> <a id="528" class="Keyword">hiding</a> <a id="535" class="Symbol">(</a><a id="536" href="Data.List.NonEmpty.Base.html#1291" class="Field">head</a><a id="540" class="Symbol">)</a>
<a id="542" class="Keyword">open</a> <a id="547" class="Keyword">import</a> <a id="554" href="Data.Maybe.html" class="Module">Data.Maybe</a>

<a id="566" class="Keyword">open</a> <a id="571" class="Keyword">import</a> <a id="578" href="libraries.listLib.html" class="Module">libraries.listLib</a>
<a id="596" class="Keyword">open</a> <a id="601" class="Keyword">import</a> <a id="608" href="libraries.natLib.html" class="Module">libraries.natLib</a>
<a id="625" class="Keyword">open</a> <a id="630" class="Keyword">import</a> <a id="637" href="libraries.boolLib.html" class="Module">libraries.boolLib</a>

<a id="656" class="Keyword">open</a> <a id="661" class="Keyword">import</a> <a id="668" href="stack.html" class="Module">stack</a>
<a id="674" class="Keyword">open</a> <a id="679" class="Keyword">import</a> <a id="686" href="instruction.html" class="Module">instruction</a>

<a id="699" class="Keyword">record</a> <a id="SignedWithSigPbk"></a><a id="706" href="ledger.html#706" class="Record">SignedWithSigPbk</a> <a id="723" class="Symbol">(</a><a id="724" href="ledger.html#724" class="Bound">msg</a> <a id="728" class="Symbol">:</a> <a id="730" href="basicBitcoinDataType.html#726" class="Datatype">Msg</a><a id="733" class="Symbol">)(</a><a id="735" href="ledger.html#735" class="Bound">address</a> <a id="743" class="Symbol">:</a> <a id="745" href="basicBitcoinDataType.html#586" class="Function">Address</a><a id="752" class="Symbol">)</a> <a id="754" class="Symbol">:</a> <a id="756" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="760" class="Keyword">where</a>
  <a id="768" class="Keyword">field</a>  <a id="SignedWithSigPbk.publicKey"></a><a id="775" href="ledger.html#775" class="Field">publicKey</a>  <a id="786" class="Symbol">:</a>  <a id="789" href="basicBitcoinDataType.html#671" class="Function">PublicKey</a>
         <a id="SignedWithSigPbk.pbkCorrect"></a><a id="808" href="ledger.html#808" class="Field">pbkCorrect</a> <a id="819" class="Symbol">:</a>  <a id="822" href="ledger.html#50" class="Bound">param</a> <a id="828" class="Symbol">.</a><a id="829" href="basicBitcoinDataType.html#1082" class="Field">publicKey2Address</a> <a id="847" href="ledger.html#775" class="Field">publicKey</a> <a id="857" href="libraries.natLib.html#534" class="Function Operator">≡ℕ</a>  <a id="861" href="ledger.html#735" class="Bound">address</a>
         <a id="SignedWithSigPbk.signature"></a><a id="878" href="ledger.html#878" class="Field">signature</a>  <a id="889" class="Symbol">:</a>  <a id="892" href="basicBitcoinDataType.html#639" class="Function">Signature</a>
         <a id="SignedWithSigPbk.signed"></a><a id="911" href="ledger.html#911" class="Field">signed</a>     <a id="922" class="Symbol">:</a>  <a id="925" href="basicBitcoinDataType.html#1244" class="Function">Signed</a> <a id="932" href="ledger.html#50" class="Bound">param</a> <a id="938" href="ledger.html#724" class="Bound">msg</a> <a id="942" href="ledger.html#878" class="Field">signature</a> <a id="952" href="ledger.html#775" class="Field">publicKey</a>


<a id="964" class="Comment">-- record for the transaction field</a>
<a id="1000" class="Keyword">record</a> <a id="TXFieldNew"></a><a id="1007" href="ledger.html#1007" class="Record">TXFieldNew</a> <a id="1018" class="Symbol">:</a> <a id="1020" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="1024" class="Keyword">where</a>
  <a id="1032" class="Keyword">constructor</a> <a id="txFieldNew"></a><a id="1044" href="ledger.html#1044" class="InductiveConstructor">txFieldNew</a>
  <a id="1057" class="Keyword">field</a>  <a id="TXFieldNew.amount"></a><a id="1064" href="ledger.html#1064" class="Field">amount</a>         <a id="1079" class="Symbol">:</a>  <a id="1082" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>
         <a id="TXFieldNew.address"></a><a id="1093" href="ledger.html#1093" class="Field">address</a>        <a id="1108" class="Symbol">:</a>  <a id="1111" href="basicBitcoinDataType.html#586" class="Function">Address</a>
         <a id="TXFieldNew.smartContract"></a><a id="1128" href="ledger.html#1128" class="Field">smartContract</a>  <a id="1143" class="Symbol">:</a> <a id="1145" href="instruction.html#1849" class="Function">BitcoinScript</a>

<a id="1160" class="Keyword">open</a> <a id="1165" href="ledger.html#1007" class="Module">TXFieldNew</a> <a id="1176" class="Keyword">public</a>




<a id="txField2MsgNew"></a><a id="1187" href="ledger.html#1187" class="Function">txField2MsgNew</a> <a id="1202" class="Symbol">:</a> <a id="1204" class="Symbol">(</a><a id="1205" href="ledger.html#1205" class="Bound">inp</a> <a id="1209" class="Symbol">:</a> <a id="1211" href="ledger.html#1007" class="Record">TXFieldNew</a><a id="1221" class="Symbol">)</a> <a id="1223" class="Symbol">→</a> <a id="1225" href="basicBitcoinDataType.html#726" class="Datatype">Msg</a>
<a id="1229" href="ledger.html#1187" class="Function">txField2MsgNew</a> <a id="1244" href="ledger.html#1244" class="Bound">inp</a>  <a id="1249" class="Symbol">=</a>   <a id="1253" href="basicBitcoinDataType.html#745" class="InductiveConstructor">nat</a> <a id="1257" class="Symbol">(</a><a id="1258" href="ledger.html#1064" class="Field">amount</a> <a id="1265" href="ledger.html#1244" class="Bound">inp</a><a id="1268" class="Symbol">)</a> <a id="1270" href="basicBitcoinDataType.html#779" class="InductiveConstructor Operator">+msg</a> <a id="1275" href="basicBitcoinDataType.html#745" class="InductiveConstructor">nat</a> <a id="1279" class="Symbol">(</a><a id="1280" href="ledger.html#1093" class="Field">address</a> <a id="1288" href="ledger.html#1244" class="Bound">inp</a><a id="1291" class="Symbol">)</a>



<a id="txFieldList2MsgNew"></a><a id="1296" href="ledger.html#1296" class="Function">txFieldList2MsgNew</a> <a id="1315" class="Symbol">:</a> <a id="1317" class="Symbol">(</a><a id="1318" href="ledger.html#1318" class="Bound">inp</a> <a id="1322" class="Symbol">:</a> <a id="1324" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="1329" href="ledger.html#1007" class="Record">TXFieldNew</a><a id="1339" class="Symbol">)</a> <a id="1341" class="Symbol">→</a> <a id="1343" href="basicBitcoinDataType.html#726" class="Datatype">Msg</a>
<a id="1347" href="ledger.html#1296" class="Function">txFieldList2MsgNew</a> <a id="1366" href="ledger.html#1366" class="Bound">inp</a>  <a id="1371" class="Symbol">=</a> <a id="1373" href="basicBitcoinDataType.html#816" class="InductiveConstructor">list</a> <a id="1378" class="Symbol">(</a><a id="1379" href="libraries.listLib.html#857" class="Function">mapL</a> <a id="1384" href="ledger.html#1187" class="Function">txField2MsgNew</a> <a id="1399" href="ledger.html#1366" class="Bound">inp</a><a id="1402" class="Symbol">)</a>


<a id="txFieldList2TotalAmountNew"></a><a id="1406" href="ledger.html#1406" class="Function">txFieldList2TotalAmountNew</a> <a id="1433" class="Symbol">:</a> <a id="1435" class="Symbol">(</a><a id="1436" href="ledger.html#1436" class="Bound">inp</a> <a id="1440" class="Symbol">:</a> <a id="1442" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="1447" href="ledger.html#1007" class="Record">TXFieldNew</a><a id="1457" class="Symbol">)</a> <a id="1459" class="Symbol">→</a> <a id="1461" href="basicBitcoinDataType.html#560" class="Function">Amount</a>
<a id="1468" href="ledger.html#1406" class="Function">txFieldList2TotalAmountNew</a> <a id="1495" href="ledger.html#1495" class="Bound">inp</a> <a id="1499" class="Symbol">=</a> <a id="1501" href="libraries.listLib.html#7885" class="Function">sumListViaf</a> <a id="1513" href="ledger.html#1064" class="Field">amount</a> <a id="1520" href="ledger.html#1495" class="Bound">inp</a>



<a id="1527" class="Comment">-- record for unsigned transaction</a>
<a id="1562" class="Keyword">record</a> <a id="TXUnsignedNew"></a><a id="1569" href="ledger.html#1569" class="Record">TXUnsignedNew</a> <a id="1583" class="Symbol">:</a> <a id="1585" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="1589" class="Keyword">where</a>
  <a id="1597" class="Keyword">field</a>  <a id="TXUnsignedNew.inputs"></a><a id="1604" href="ledger.html#1604" class="Field">inputs</a>   <a id="1613" class="Symbol">:</a> <a id="1615" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="1620" href="ledger.html#1007" class="Record">TXFieldNew</a>
         <a id="TXUnsignedNew.outputs"></a><a id="1640" href="ledger.html#1640" class="Field">outputs</a>  <a id="1649" class="Symbol">:</a> <a id="1651" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="1656" href="ledger.html#1007" class="Record">TXFieldNew</a>
         <a id="TXUnsignedNew.TXID1"></a><a id="1676" href="ledger.html#1676" class="Field">TXID1</a>     <a id="1686" class="Symbol">:</a> <a id="1688" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>
<a id="1690" class="Keyword">open</a> <a id="1695" href="ledger.html#1569" class="Module">TXUnsignedNew</a> <a id="1709" class="Keyword">public</a>




<a id="txUnsigned2MsgNew"></a><a id="1720" href="ledger.html#1720" class="Function">txUnsigned2MsgNew</a> <a id="1738" class="Symbol">:</a>  <a id="1741" class="Symbol">(</a><a id="1742" href="ledger.html#1742" class="Bound">transac</a> <a id="1750" class="Symbol">:</a> <a id="1752" href="ledger.html#1569" class="Record">TXUnsignedNew</a><a id="1765" class="Symbol">)</a> <a id="1767" class="Symbol">→</a> <a id="1769" href="basicBitcoinDataType.html#726" class="Datatype">Msg</a>
<a id="1773" href="ledger.html#1720" class="Function">txUnsigned2MsgNew</a> <a id="1791" href="ledger.html#1791" class="Bound">transac</a> <a id="1799" class="Symbol">=</a> <a id="1801" href="ledger.html#1296" class="Function">txFieldList2MsgNew</a> <a id="1820" class="Symbol">(</a><a id="1821" href="ledger.html#1604" class="Field">inputs</a> <a id="1828" href="ledger.html#1791" class="Bound">transac</a><a id="1835" class="Symbol">)</a>  <a id="1838" href="basicBitcoinDataType.html#779" class="InductiveConstructor Operator">+msg</a> <a id="1843" href="ledger.html#1296" class="Function">txFieldList2MsgNew</a> <a id="1862" class="Symbol">(</a><a id="1863" href="ledger.html#1640" class="Field">outputs</a> <a id="1871" href="ledger.html#1791" class="Bound">transac</a><a id="1878" class="Symbol">)</a>




<a id="txInput2MsgNew"></a><a id="1884" href="ledger.html#1884" class="Function">txInput2MsgNew</a> <a id="1899" class="Symbol">:</a> <a id="1901" class="Symbol">(</a><a id="1902" href="ledger.html#1902" class="Bound">inp</a> <a id="1906" class="Symbol">:</a> <a id="1908" href="ledger.html#1007" class="Record">TXFieldNew</a><a id="1918" class="Symbol">)(</a><a id="1920" href="ledger.html#1920" class="Bound">outp</a> <a id="1925" class="Symbol">:</a> <a id="1927" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="1932" href="ledger.html#1007" class="Record">TXFieldNew</a><a id="1942" class="Symbol">)</a> <a id="1944" class="Symbol">→</a> <a id="1946" href="basicBitcoinDataType.html#726" class="Datatype">Msg</a>
<a id="1950" href="ledger.html#1884" class="Function">txInput2MsgNew</a> <a id="1965" href="ledger.html#1965" class="Bound">inp</a> <a id="1969" href="ledger.html#1969" class="Bound">outp</a> <a id="1974" class="Symbol">=</a> <a id="1976" href="ledger.html#1187" class="Function">txField2MsgNew</a> <a id="1991" href="ledger.html#1965" class="Bound">inp</a> <a id="1995" href="basicBitcoinDataType.html#779" class="InductiveConstructor Operator">+msg</a> <a id="2000" href="ledger.html#1296" class="Function">txFieldList2MsgNew</a> <a id="2019" href="ledger.html#1969" class="Bound">outp</a>

<a id="tx2SignauxNew"></a><a id="2025" href="ledger.html#2025" class="Function">tx2SignauxNew</a> <a id="2039" class="Symbol">:</a> <a id="2041" class="Symbol">(</a><a id="2042" href="ledger.html#2042" class="Bound">inp</a> <a id="2046" class="Symbol">:</a> <a id="2048" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="2053" href="ledger.html#1007" class="Record">TXFieldNew</a><a id="2063" class="Symbol">)</a> <a id="2065" class="Symbol">(</a><a id="2066" href="ledger.html#2066" class="Bound">outp</a> <a id="2071" class="Symbol">:</a> <a id="2073" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="2078" href="ledger.html#1007" class="Record">TXFieldNew</a><a id="2088" class="Symbol">)</a>  <a id="2091" class="Symbol">→</a> <a id="2093" href="Agda.Primitive.html#388" class="Primitive">Set</a>
<a id="2097" href="ledger.html#2025" class="Function">tx2SignauxNew</a> <a id="2111" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>               <a id="2128" href="ledger.html#2128" class="Bound">outp</a>  <a id="2134" class="Symbol">=</a> <a id="2136" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a>
<a id="2138" href="ledger.html#2025" class="Function">tx2SignauxNew</a> <a id="2152" class="Symbol">(</a><a id="2153" href="ledger.html#2153" class="Bound">inp</a> <a id="2157" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="2159" href="ledger.html#2159" class="Bound">restinp</a><a id="2166" class="Symbol">)</a>  <a id="2169" href="ledger.html#2169" class="Bound">outp</a>  <a id="2175" class="Symbol">=</a>
    <a id="2181" href="ledger.html#706" class="Record">SignedWithSigPbk</a> <a id="2198" class="Symbol">(</a><a id="2199" href="ledger.html#1884" class="Function">txInput2MsgNew</a> <a id="2214" href="ledger.html#2153" class="Bound">inp</a> <a id="2218" href="ledger.html#2169" class="Bound">outp</a><a id="2222" class="Symbol">)</a> <a id="2224" class="Symbol">(</a><a id="2225" href="ledger.html#1093" class="Field">address</a> <a id="2233" href="ledger.html#2153" class="Bound">inp</a><a id="2236" class="Symbol">)</a> <a id="2238" href="Data.Product.Base.html#1618" class="Function Operator">×</a>  <a id="2241" href="ledger.html#2025" class="Function">tx2SignauxNew</a> <a id="2255" href="ledger.html#2159" class="Bound">restinp</a> <a id="2263" href="ledger.html#2169" class="Bound">outp</a>




<a id="tx2SignNew"></a><a id="2272" href="ledger.html#2272" class="Function">tx2SignNew</a> <a id="2283" class="Symbol">:</a> <a id="2285" href="ledger.html#1569" class="Record">TXUnsignedNew</a> <a id="2299" class="Symbol">→</a> <a id="2301" href="Agda.Primitive.html#388" class="Primitive">Set</a>
<a id="2305" href="ledger.html#2272" class="Function">tx2SignNew</a> <a id="2316" href="ledger.html#2316" class="Bound">tr</a> <a id="2319" class="Symbol">=</a> <a id="2321" href="ledger.html#2025" class="Function">tx2SignauxNew</a> <a id="2335" class="Symbol">(</a><a id="2336" href="ledger.html#1604" class="Field">inputs</a> <a id="2343" href="ledger.html#2316" class="Bound">tr</a><a id="2345" class="Symbol">)</a> <a id="2347" class="Symbol">(</a><a id="2348" href="ledger.html#1640" class="Field">outputs</a> <a id="2356" href="ledger.html#2316" class="Bound">tr</a><a id="2358" class="Symbol">)</a>

<a id="2361" class="Comment">-- \bitcoinVersFive</a>


<a id="2383" class="Keyword">record</a> <a id="TXNew"></a><a id="2390" href="ledger.html#2390" class="Record">TXNew</a> <a id="2396" class="Symbol">:</a> <a id="2398" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="2402" class="Keyword">where</a>
  <a id="2410" class="Keyword">field</a>  <a id="TXNew.tx"></a><a id="2417" href="ledger.html#2417" class="Field">tx</a>       <a id="2426" class="Symbol">:</a> <a id="2428" href="ledger.html#1569" class="Record">TXUnsignedNew</a>
         <a id="TXNew.cor"></a><a id="2451" href="ledger.html#2451" class="Field">cor</a>      <a id="2460" class="Symbol">:</a> <a id="2462" href="ledger.html#1406" class="Function">txFieldList2TotalAmountNew</a> <a id="2489" class="Symbol">(</a><a id="2490" href="ledger.html#1604" class="Field">inputs</a> <a id="2497" href="ledger.html#2417" class="Field">tx</a><a id="2499" class="Symbol">)</a> <a id="2501" href="Data.Nat.Base.html#2259" class="Function Operator">≥</a> <a id="2503" href="ledger.html#1406" class="Function">txFieldList2TotalAmountNew</a> <a id="2530" class="Symbol">(</a><a id="2531" href="ledger.html#1640" class="Field">outputs</a> <a id="2539" href="ledger.html#2417" class="Field">tx</a><a id="2541" class="Symbol">)</a>
         <a id="TXNew.nonEmpt"></a><a id="2552" href="ledger.html#2552" class="Field">nonEmpt</a>  <a id="2561" class="Symbol">:</a> <a id="2563" href="libraries.listLib.html#8204" class="Function">NonNil</a> <a id="2570" class="Symbol">(</a><a id="2571" href="ledger.html#1604" class="Field">inputs</a> <a id="2578" href="ledger.html#2417" class="Field">tx</a><a id="2580" class="Symbol">)</a> <a id="2582" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="2584" href="libraries.listLib.html#8204" class="Function">NonNil</a> <a id="2591" class="Symbol">(</a><a id="2592" href="ledger.html#1640" class="Field">outputs</a> <a id="2600" href="ledger.html#2417" class="Field">tx</a><a id="2602" class="Symbol">)</a>
         <a id="TXNew.sig"></a><a id="2613" href="ledger.html#2613" class="Field">sig</a>      <a id="2622" class="Symbol">:</a> <a id="2624" href="ledger.html#2272" class="Function">tx2SignNew</a> <a id="2635" href="ledger.html#2417" class="Field">tx</a>

<a id="2639" class="Keyword">open</a> <a id="2644" href="ledger.html#2390" class="Module">TXNew</a> <a id="2650" class="Keyword">public</a>


<a id="2659" class="Comment">--record for a ledger</a>
<a id="2681" class="Keyword">record</a> <a id="ledgerEntryNew"></a><a id="2688" href="ledger.html#2688" class="Record">ledgerEntryNew</a> <a id="2703" class="Symbol">:</a> <a id="2705" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="2709" class="Keyword">where</a>   
  <a id="2720" class="Keyword">constructor</a> <a id="ledgerEntrNew"></a><a id="2732" href="ledger.html#2732" class="InductiveConstructor">ledgerEntrNew</a>
  <a id="2748" class="Keyword">field</a> <a id="ledgerEntryNew.ins"></a><a id="2754" href="ledger.html#2754" class="Field">ins</a>       <a id="2764" class="Symbol">:</a> <a id="2766" href="instruction.html#1849" class="Function">BitcoinScript</a>
        <a id="ledgerEntryNew.amount"></a><a id="2788" href="ledger.html#2788" class="Field">amount</a>    <a id="2798" class="Symbol">:</a> <a id="2800" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>

<a id="2803" class="Keyword">open</a> <a id="2808" href="ledger.html#2688" class="Module">ledgerEntryNew</a> <a id="2823" class="Keyword">public</a>

<a id="2831" class="Keyword">record</a> <a id="LedgerNew"></a><a id="2838" href="ledger.html#2838" class="Record">LedgerNew</a> <a id="2848" class="Symbol">:</a> <a id="2850" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="2854" class="Keyword">where</a>
  <a id="2862" class="Keyword">constructor</a> <a id="ledger"></a><a id="2874" href="ledger.html#2874" class="InductiveConstructor">ledger</a>
  <a id="2883" class="Keyword">field</a>
     <a id="LedgerNew.entries"></a><a id="2894" href="ledger.html#2894" class="Field">entries</a>        <a id="2909" class="Symbol">:</a> <a id="2911" class="Symbol">(</a><a id="2912" href="ledger.html#2912" class="Bound">addr</a> <a id="2917" class="Symbol">:</a> <a id="2919" href="basicBitcoinDataType.html#586" class="Function">Address</a><a id="2926" class="Symbol">)</a> <a id="2928" class="Symbol">→</a> <a id="2930" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="2936" href="ledger.html#2688" class="Record">ledgerEntryNew</a>
     <a id="LedgerNew.currentTime"></a><a id="2956" href="ledger.html#2956" class="Field">currentTime</a>    <a id="2971" class="Symbol">:</a> <a id="2973" href="basicBitcoinDataType.html#534" class="Function">Time</a>
<a id="2978" class="Keyword">open</a> <a id="2983" href="ledger.html#2838" class="Module">LedgerNew</a> <a id="2993" class="Keyword">public</a>


<a id="3002" class="Comment">--record for transaction entry</a>
<a id="3033" class="Keyword">record</a> <a id="TXEntryNew"></a><a id="3040" href="ledger.html#3040" class="Record">TXEntryNew</a> <a id="3051" class="Symbol">:</a> <a id="3053" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="3057" class="Keyword">where</a>
  <a id="3065" class="Keyword">constructor</a> <a id="txentryNew"></a><a id="3077" href="ledger.html#3077" class="InductiveConstructor">txentryNew</a>
  <a id="3090" class="Keyword">field</a> <a id="TXEntryNew.amount"></a><a id="3096" href="ledger.html#3096" class="Field">amount</a>              <a id="3116" class="Symbol">:</a> <a id="3118" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>
        <a id="TXEntryNew.smartContract"></a><a id="3128" href="ledger.html#3128" class="Field">smartContract</a>       <a id="3148" class="Symbol">:</a> <a id="3150" href="instruction.html#1849" class="Function">BitcoinScript</a>
        <a id="TXEntryNew.address"></a><a id="3172" href="ledger.html#3172" class="Field">address</a>             <a id="3192" class="Symbol">:</a> <a id="3194" href="basicBitcoinDataType.html#586" class="Function">Address</a> <a id="3202" class="Comment">-- indentifiers for unspentTX outputs (UTXO) (Lists of UTXO)</a>

<a id="3264" class="Keyword">open</a> <a id="3269" href="ledger.html#3040" class="Module">TXEntryNew</a> <a id="3280" class="Keyword">public</a>


<a id="testLedgerNewEntries"></a><a id="3289" href="ledger.html#3289" class="Function">testLedgerNewEntries</a> <a id="3310" class="Symbol">:</a> <a id="3312" href="basicBitcoinDataType.html#586" class="Function">Address</a> <a id="3320" class="Symbol">→</a> <a id="3322" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="3328" href="ledger.html#2688" class="Record">ledgerEntryNew</a>
<a id="3343" href="ledger.html#3289" class="Function">testLedgerNewEntries</a> <a id="3364" href="Agda.Builtin.Nat.html#221" class="InductiveConstructor">zero</a> <a id="3369" class="Symbol">=</a> <a id="3371" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="3376" class="Symbol">(</a><a id="3377" href="ledger.html#2732" class="InductiveConstructor">ledgerEntrNew</a> <a id="3391" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="3394" class="Number">50</a><a id="3396" class="Symbol">)</a>
<a id="3398" href="ledger.html#3289" class="Function">testLedgerNewEntries</a> <a id="3419" class="Symbol">(</a><a id="3420" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="3424" href="Agda.Builtin.Nat.html#221" class="InductiveConstructor">zero</a><a id="3428" class="Symbol">)</a> <a id="3430" class="Symbol">=</a> <a id="3432" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="3437" class="Symbol">(</a><a id="3438" href="ledger.html#2732" class="InductiveConstructor">ledgerEntrNew</a> <a id="3452" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="3455" class="Number">80</a><a id="3457" class="Symbol">)</a>
<a id="3459" href="ledger.html#3289" class="Function">testLedgerNewEntries</a> <a id="3480" class="Symbol">(</a><a id="3481" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="3485" class="Symbol">(</a><a id="3486" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="3490" href="ledger.html#3490" class="Bound">x</a><a id="3491" class="Symbol">))</a> <a id="3494" class="Symbol">=</a> <a id="3496" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>

<a id="testLedgerNew"></a><a id="3505" href="ledger.html#3505" class="Function">testLedgerNew</a> <a id="3519" class="Symbol">:</a> <a id="3521" href="ledger.html#2838" class="Record">LedgerNew</a>
<a id="3531" href="ledger.html#3505" class="Function">testLedgerNew</a> <a id="3545" class="Symbol">.</a><a id="3546" href="ledger.html#2894" class="Field">entries</a> <a id="3554" class="Symbol">=</a> <a id="3556" href="ledger.html#3289" class="Function">testLedgerNewEntries</a>
<a id="3577" href="ledger.html#3505" class="Function">testLedgerNew</a> <a id="3591" class="Symbol">.</a><a id="3592" href="ledger.html#2956" class="Field">currentTime</a> <a id="3604" class="Symbol">=</a> <a id="3606" class="Number">31</a>

<a id="3610" class="Comment">-- record for transaction</a>
<a id="3636" class="Keyword">record</a> <a id="transactionNew"></a><a id="3643" href="ledger.html#3643" class="Record">transactionNew</a> <a id="3658" class="Symbol">:</a> <a id="3660" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="3664" class="Keyword">where</a> 
  <a id="3673" class="Keyword">constructor</a> <a id="transactNew"></a><a id="3685" href="ledger.html#3685" class="InductiveConstructor">transactNew</a>
  <a id="3699" class="Keyword">field</a> <a id="transactionNew.txid"></a><a id="3705" href="ledger.html#3705" class="Field">txid</a>      <a id="3715" class="Symbol">:</a> <a id="3717" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>
        <a id="transactionNew.inputs"></a><a id="3727" href="ledger.html#3727" class="Field">inputs</a>    <a id="3737" class="Symbol">:</a> <a id="3739" href="ledger.html#3040" class="Record">TXEntryNew</a>
        <a id="transactionNew.outputs"></a><a id="3758" href="ledger.html#3758" class="Field">outputs</a>   <a id="3768" class="Symbol">:</a> <a id="3770" href="ledger.html#3040" class="Record">TXEntryNew</a>

<a id="3782" class="Keyword">open</a> <a id="3787" href="ledger.html#3643" class="Module">transactionNew</a> <a id="3802" class="Keyword">public</a>

<a id="3810" class="Comment">-- function that is used to check if the coins go to the same address</a>
<a id="processLedger"></a><a id="3880" href="ledger.html#3880" class="Function">processLedger</a> <a id="3894" class="Symbol">:</a> <a id="3896" href="ledger.html#2838" class="Record">LedgerNew</a> <a id="3906" class="Symbol">→</a>  <a id="3909" href="ledger.html#3643" class="Record">transactionNew</a>  <a id="3925" class="Symbol">→</a> <a id="3927" href="ledger.html#2838" class="Record">LedgerNew</a>
<a id="3937" href="ledger.html#3880" class="Function">processLedger</a> <a id="3951" href="ledger.html#3951" class="Bound">oldLed</a>
              <a id="3972" class="Symbol">(</a><a id="3973" href="ledger.html#3685" class="InductiveConstructor">transactNew</a> <a id="3985" href="ledger.html#3985" class="Bound">txid₁</a> <a id="3991" class="Symbol">(</a><a id="3992" href="ledger.html#3077" class="InductiveConstructor">txentryNew</a> <a id="4003" href="ledger.html#4003" class="Bound">amount₁</a> <a id="4011" href="ledger.html#4011" class="Bound">smartContract₁</a> <a id="4026" href="ledger.html#4026" class="Bound">recipientAddress</a><a id="4042" class="Symbol">)</a>
                <a id="4060" class="Symbol">(</a><a id="4061" href="ledger.html#3077" class="InductiveConstructor">txentryNew</a> <a id="4072" href="ledger.html#4072" class="Bound">amount₂</a> <a id="4080" href="ledger.html#4080" class="Bound">smartContract₂</a> <a id="4095" href="ledger.html#4095" class="Bound">desinntationAddress</a><a id="4114" class="Symbol">))</a>
              <a id="4131" class="Symbol">.</a><a id="4132" href="ledger.html#2894" class="Field">entries</a> <a id="4140" href="ledger.html#4140" class="Bound">addr</a>
            <a id="4157" class="Symbol">=</a>  <a id="4160" href="libraries.boolLib.html#230" class="Function Operator">if</a> <a id="4163" class="Symbol">(</a><a id="4164" href="ledger.html#4140" class="Bound">addr</a> <a id="4169" href="libraries.natLib.html#723" class="Function Operator">==b</a> <a id="4173" href="ledger.html#4026" class="Bound">recipientAddress</a><a id="4189" class="Symbol">)</a>
               <a id="4206" href="libraries.boolLib.html#230" class="Function Operator">then</a> <a id="4211" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>
               <a id="4234" href="libraries.boolLib.html#230" class="Function Operator">else</a> <a id="4239" class="Symbol">(</a> <a id="4241" href="libraries.boolLib.html#230" class="Function Operator">if</a> <a id="4244" class="Symbol">(</a><a id="4245" href="ledger.html#4140" class="Bound">addr</a> <a id="4250" href="libraries.natLib.html#723" class="Function Operator">==b</a> <a id="4254" href="ledger.html#4095" class="Bound">desinntationAddress</a><a id="4273" class="Symbol">)</a>
                      <a id="4297" href="libraries.boolLib.html#230" class="Function Operator">then</a>  <a id="4303" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="4308" class="Symbol">(</a><a id="4309" href="ledger.html#2732" class="InductiveConstructor">ledgerEntrNew</a> <a id="4323" href="ledger.html#4080" class="Bound">smartContract₂</a>  <a id="4339" href="ledger.html#4072" class="Bound">amount₂</a><a id="4346" class="Symbol">)</a>
                      <a id="4370" href="libraries.boolLib.html#230" class="Function Operator">else</a>  <a id="4376" href="ledger.html#3951" class="Bound">oldLed</a> <a id="4383" class="Symbol">.</a><a id="4384" href="ledger.html#2894" class="Field">entries</a> <a id="4392" href="ledger.html#4140" class="Bound">addr</a> <a id="4397" class="Symbol">)</a>
<a id="4399" href="ledger.html#3880" class="Function">processLedger</a> <a id="4413" href="ledger.html#4413" class="Bound">oldLed</a> <a id="4420" href="ledger.html#4420" class="Bound">trans</a> <a id="4426" class="Symbol">.</a><a id="4427" href="ledger.html#2956" class="Field">currentTime</a> <a id="4439" class="Symbol">=</a> <a id="4441" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="4445" class="Symbol">(</a><a id="4446" href="ledger.html#4413" class="Bound">oldLed</a> <a id="4453" class="Symbol">.</a><a id="4454" href="ledger.html#2956" class="Field">currentTime</a><a id="4465" class="Symbol">)</a>

<a id="tx2MsgNew"></a><a id="4468" href="ledger.html#4468" class="Function">tx2MsgNew</a> <a id="4478" class="Symbol">:</a> <a id="4480" href="ledger.html#3643" class="Record">transactionNew</a> <a id="4495" class="Symbol">→</a> <a id="4497" href="basicBitcoinDataType.html#726" class="Datatype">Msg</a>
<a id="4501" href="ledger.html#4468" class="Function">tx2MsgNew</a>  <a id="4512" href="ledger.html#4512" class="Bound">t</a>  <a id="4515" class="Symbol">=</a> <a id="4517" href="basicBitcoinDataType.html#745" class="InductiveConstructor">nat</a> <a id="4521" class="Symbol">(</a><a id="4522" href="ledger.html#3705" class="Field">txid</a> <a id="4527" href="ledger.html#4512" class="Bound">t</a><a id="4528" class="Symbol">)</a>
</pre></body></html>